#!/bin/bash
#--------------------------------------------------------------------------------
#################################################################################
#--------------------------------------------------------------------------------
[ "${ZIG_BUILD_MODE}" == "" ] && ZIG_BUILD_MODE="ReleaseSmall"
#--------------------------------------------------------------------------------
#################################################################################
#--------------------------------------------------------------------------------
if [ "${1}" != "" ] && [ -f "${1}" ]
then
	#----------------------------------------
	SOURCE=${1}; shift
	#----------------------------------------
	zig run ${SOURCE} -O ${ZIG_BUILD_MODE} -- ${*}
	#----------------------------------------
	exit 0
	#----------------------------------------
fi
#--------------------------------------------------------------------------------
#################################################################################
#--------------------------------------------------------------------------------
DIRECTORY=$(pwd)
#--------------------------------------------------------------------------------
BASENAME=$(basename "$(pwd)")
#--------------------------------------------------------------------------------
SOURCE=""
#--------------------------------------------------------------------------------
#################################################################################
#--------------------------------------------------------------------------------
if [ -f "build" ]
then
	#----------------------------------------
	/bin/bash ${DIRECTORY}/build run ${*}
	exit $?
	#----------------------------------------
elif { [ -f "Taskfile.yml" ] || [ -f "Taskfile.yaml" ] || [ -f "taskfile.yml" ] || [ -f "taskfile.yaml" ]; } && task --list-all | grep -q run
then
	#----------------------------------------
	task run -- ${*}
	#----------------------------------------
	exit $?
	#----------------------------------------
elif { [ -f "Makefile" ] || [ -f "makefile" ]; } && make -qp | awk -F':' '/^[a-zA-Z0-9][^$#\/\t=]*:/ {print $1}' | grep -q "^run$"
then
	#----------------------------------------
	make run ARGS="${*}"
	#----------------------------------------
	exit $?
	#----------------------------------------
elif [ -f "main.zig" ]
then
	#----------------------------------------
	SOURCE="main.zig"
	#----------------------------------------
elif [ -f "root.zig" ]
then
	#----------------------------------------
	SOURCE="root.zig"
	#----------------------------------------
else
	#----------------------------------------
	if [ -f "${BASENAME}.zig" ]
	then
		#----------------------------------------
		SOURCE="${BASENAME}.zig"
		#----------------------------------------
	else
		#----------------------------------------
		echo "unknown source filename"
		exit 1
		#----------------------------------------
	fi
	#----------------------------------------
fi
#--------------------------------------------------------------------------------
#################################################################################
#--------------------------------------------------------------------------------
if [ -f "${SOURCE}" ]
then
	#----------------------------------------
	zig run ${SOURCE} -O ${ZIG_BUILD_MODE} -- ${*}
	#----------------------------------------
else
	#----------------------------------------
	zigbuild-run ${*}
	#----------------------------------------
fi
#--------------------------------------------------------------------------------
#################################################################################
#--------------------------------------------------------------------------------

