#!/bin/bash
#--------------------------------------------------------------------------------
#################################################################################
#--------------------------------------------------------------------------------
DIRECTORY=$(pwd); BASENAME=$(basename "$(pwd)")
#--------------------------------------------------------------------------------
OUTPUT=${BASENAME}; OUTPUT_PATH="zig-out"
#--------------------------------------------------------------------------------
#################################################################################
#--------------------------------------------------------------------------------
SOURCE=${1}; shift
#--------------------------------------------------------------------------------
if { [ -f "Taskfile.yml" ] || [ -f "Taskfile.yaml" ] || [ -f "taskfile.yml" ] || [ -f "taskfile.yaml" ]; } && task --list-all | grep -q run:
then
	#----------------------------------------
	task run
	#----------------------------------------
	exit $?
	#----------------------------------------
elif { [ -f "Makefile" ] || [ -f "makefile" ]; } && make -qp | awk -F':' '/^[a-zA-Z0-9][^$#\/\t=]*:/ {print $1}' | grep -q "^run$"
then
	#----------------------------------------
	make run
	#----------------------------------------
	exit $?
	#----------------------------------------
elif [ -f "build" ]
then
	#----------------------------------------
	/bin/bash ${DIRECTORY}/build run
	#----------------------------------------
	exit $?
	#----------------------------------------
fi
#--------------------------------------------------------------------------------
zigbuild ${SOURCE}
#--------------------------------------------------------------------------------
if [ $? -eq 0 ]
then
	if [ -f "./${OUTPUT}" ]
	then
		./${OUTPUT} ${*}
	elif [ -d "${OUTPUT_PATH}" ] && [ -f "${OUTPUT_PATH}/${OUTPUT}" ]
	then
		cd ${OUTPUT_PATH}
		./${OUTPUT} ${*}
	elif [ -d "${OUTPUT_PATH}" ] && [ -d "${OUTPUT_PATH}/bin" ] && [ -f "${OUTPUT_PATH}/bin/${OUTPUT}" ]
	then
		cd ${OUTPUT_PATH}/bin
		./${OUTPUT} ${*}
	fi
fi
#--------------------------------------------------------------------------------
exit $?
#--------------------------------------------------------------------------------
#################################################################################
#--------------------------------------------------------------------------------
